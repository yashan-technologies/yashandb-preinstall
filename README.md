# YashanDB Preinstall | 部署前环境配置检查工具

## 简介

适⽤于崖山数据库⽣产环境部署的环境配置检查⼯具，简化安装数据库前的环境配置检查动作，标准化基础环境部署流程。

## 特性

1 配置环境
1.1 创建数据库安装用户。
1.2 配置数据库用户Ulimit。
1.3 创建数据库安装目录。
1.4 关闭透明大页和NUMA。
1.5 调整内核参数为部署推荐值。
1.6 按需调整时区配置。
1.7 修改磁盘队列调度器（可选）。

2 检查环境
2.1 检查主机基本信息：硬件信息、防火墙等配置。
2.2 检查配置环境结果是否符合预期。
2.3 异常检查结果告警。
2.4 Fio磁盘性能测试（可选）。

## 快速上手

### 命令介绍

```bash
# 推荐使用root用户或者sudo执行命令，无权限的项目会跳过并且打印提示信息

# 进行环境配置检查
sudo ./preinstall

# 附加进行I/O测试
sudo ./preinstall -i

# 附加修改磁盘队列调度器
sudo ./preinstall -s

# 跳过环境配置，只进行环境检查
sudo ./preinstall -o

# 查看帮助信息
./preinstall -h
```

### 修改崖山数据库配置

修改`config/yashandb.toml`，配置文件内容如下：
```toml
# 数据库配置
install_path = "/data"                     # 安装路径（绝对路径，如果为空则使用数据库用户的家目录作为 install_path）
yasdb_home = "./yasdb_home"                # 家目录（默认为相对路径，拼接到 install_path，可以指定绝对路径）
yasdb_data = "./yasdb_data"                # 数据目录（默认为相对路径，拼接到 install_path，可以指定绝对路径）
yasdb_back = "./yasdb_back"                # 备份目录（默认为相对路径，拼接到 install_path，可以指定绝对路径）
yasdb_back_subdirs = ["archive", "backup"] # 备份子目录，拼接到 yasdb_back

# =================================================================================================
# 其他主机列表
# 用于测试SSH连通性，如果不填写，会自动跳过SSH连接测试

# 主机一
# [[hosts]]
# ip = ""       # 主机IP
# user = ""     # 登录用户
# password = "" # 登录密码
# port = 22     # SSH端口

# 主机二
# [[hosts]]
# ip = ""       # 主机IP
# user = ""     # 登录用户
# password = "" # 登录密码
# port = 22     # SSH端口

# ......
# =================================================================================================
```


